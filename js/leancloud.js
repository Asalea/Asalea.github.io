function init(o){var i=$(".leancloud_visitors").attr("data-url").trim()||$(".leancloud_likes").attr("data-url").trim(),n=$(".leancloud_visitors").attr("data-title").trim()||$(".leancloud_likes").attr("data-title").trim(),t=new AV.Query(o);t.equalTo("url",i),t.find().then(function(t){if(0<t.length)console.log("Object instance already exists.");else{var e=new o;e.set("url",i),e.set("title",n),e.set("visitors",0),e.set("likes",0),e.save().then(function(t){console.log("Succed to create."),console.log("New object created with objectId: "+t.id)},function(t){console.log("Failed to create!"),console.error("Failed to create new object, with error message: "+t.message)})}},function(t){console.log("Error:"+t.code+" "+t.message)})}function addVisitors(t){var e=$(".leancloud_visitors").attr("data-url").trim(),o=($(".leancloud_visitors").attr("data-title").trim(),$(".leancloud_visitors_count").attr("id").trim()),i=new AV.Query(t);i.equalTo("url",e),i.find().then(function(t){if(0<t.length){var e=t[0];e.increment("visitors"),e.fetchWhenSave(!0),e.save().then(function(t){var e=t.get("visitors");$(document.getElementById(o)).text(e),console.log("Succed to add visitors."),console.log("New visitors: "+t.id+" "+t.get("url")+" "+t.get("visitors"))},function(t){console.log("Failed to add visitors!"),console.log("Error:"+t.code+" "+t.message)})}},function(t){console.log("Error:"+t.code+" "+t.message)})}function addLikes(t){var e=$(".leancloud_likes").attr("data-url").trim(),o=($(".leancloud_likes").attr("data-title").trim(),$(".leancloud_likes_count").attr("id").trim()),i=new AV.Query(t);i.equalTo("url",e),i.find().then(function(t){if(0<t.length){var e=t[0];e.increment("likes"),e.fetchWhenSave(!0),e.save().then(function(t){var e=t.get("likes");$(document.getElementById(o)).text(e),console.log("Succed to add likes."),console.log("New likes: "+t.id+" "+t.get("url")+" "+t.get("likes"))},function(t){console.log("Failed to add likes!"),console.log("Error:"+t.code+" "+t.message)})}},function(t){console.log("Error:"+t.code+" "+t.message)})}function showVisitors(t){var e=new AV.Query(t),s=[];$(".leancloud_visitors").each(function(){s.push($(this).attr("data-url").trim())}),e.containedIn("url",s),e.find().then(function(t){var e=".leancloud_visitors_count";if(0!==t.length){for(var o=0;o<t.length;o++){var i=t[o],n=i.get("url"),l=i.get("visitors"),r=document.getElementById(n+"_visitors");$(r).find(e).text(l)}for(o=0;o<s.length;o++){n=s[o],r=document.getElementById(n+"_visitors");""==$(r).find(e).text()&&$(r).find(e).text(0)}}else $(".leancloud_visitors").find(e).text(0)},function(t){console.log("Error: "+t.code+" "+t.message)})}function showLikes(t){var e=new AV.Query(t),s=[];$(".leancloud_likes").each(function(){s.push($(this).attr("data-url").trim())}),e.containedIn("url",s),e.find().then(function(t){var e=".leancloud_likes_count";if(0!==t.length){for(var o=0;o<t.length;o++){var i=t[o],n=i.get("url"),l=i.get("likes"),r=document.getElementById(n+"_likes");$(r).find(e).text(l)}for(o=0;o<s.length;o++){n=s[o],r=document.getElementById(n+"_likes");""==$(r).find(e).text()&&$(r).find(e).text(0)}}else $(".leancloud_likes").find(e).text(0)},function(t){console.log("Error: "+t.code+" "+t.message)})}function topNPost(t,s){var e=new AV.Query("Counter");e.notEqualTo("id",0),e.descending("visitors"),e.limit(s),e.find().then(function(t){var e=s>t.length?t.length:s;if(0<e){for(var o=0;o<e;o++){var i=t[o],n="<ul class='topN-post-list'><li class='topN-post-item'><span class='item-topNumber'>TOP"+(o+1)+"</span><a class='item-title' href='"+i.get("url")+"'>"+i.get("title")+"</a><i class='item-visitors'>【文章热度:"+i.get("visitors")+"℃】</i></li></ul>";$("#topN").append(n)}var l=".topN-title",r=$(l).attr("data-title").trim();$(l).text(r+"("+e+" posts)")}console.log("Succed to find topNPost.")},function(t){console.log("Error: "+t.code+" "+t.message)})}function getCookie(t){for(var e=t+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){var n=o[i].trim();if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""}function getCookieById(t,e){for(var o=t+"=",i=document.cookie.split(";"),n="",l=0;l<i.length;l++){0==(s=i[l].trim()).indexOf(o)&&(n=s.substring(o.length,s.length))}if(""!=n){var r=n.split(",");for(l=0;l<r.length;l++){var s;if(0==(s=r[l].trim()).indexOf(e))return!0}}return""}function addCookieById(t,e,o){var i=getCookie(t);if(""==i)i=e;else{for(var n=i.split(","),l=0,r=0;r<n.length;r++){if(0==n[r].trim().indexOf(e)){l=1;break}}0==l&&(i+=","+e)}var s=new Date;s.setTime(s.getTime()+24*o*60*60*1e3);var a="expires="+s.toGMTString();document.cookie=t+"="+i+"; "+a}function AnnieLeancloud(t,e){AV.initialize(t,e);var o=AV.Object.extend("Counter");return $(".layout-post").length?function(){if(init(o),1==$(".leancloud_visitors").length&&addVisitors(o),$(".leancloud_likes").length){var t=$(".leancloud_likes").attr("data-url").trim(),e=getCookieById("star",t);""!=e&&$(".leancloud_likes").addClass("heartAnimation"),showLikes(o),$(".layout-post").on("click",".leancloud_likes",function(){"unlike"===$(this).attr("rel")&&""==e&&(addLikes(o),$(this).addClass("heartAnimation").attr("rel","like"),addCookieById("star",t,.5))})}}():($(".layout-pure").length||$(".layout-cart").length)&&1<=$(".post-title").length?($(".leancloud_visitors").length&&showVisitors(o),void($(".leancloud_likes").length&&showLikes(o))):void 0}